# Chess Auto Analyzer

Автоматический инструмент для пакетного анализа шахматных партий (PGN). Программа использует движок Stockfish для поиска ошибок и классифицирует их по тактическим мотивам, а также проверяет качество разыгрывания дебюта.

## Возможности

* **Автоматический поиск учеников:** Сканирует все PGN файлы и находит игроков, сыгравших больше N партий.
* **Глубокий анализ:** Использует Stockfish для оценки позиций.
* **Классификация ошибок:**
    * Зевок фигуры (Hanging Piece).
    * Подставка под бой (Moving into Danger).
    * Упущенный мат (Missed Mate).
* **Определение тактических мотивов:**
    * Вилка (Fork).
    * Связка (Pin).
    * Линейный удар (Skewer).
    * Двойной шах (Double Check).
    * Вскрытый шах (Discovered Check).
    * Вскрытое нападение (Discovered Attack).
* **Дебютный контроль:**
    * Проверяет первые 15 ходов.
    * Контроль захвата центра пешками.
    * Контроль развития легких фигур (Кони, Слоны).
    * Контроль рокировки.

## Установка и запуск

1.  **Требования:**
    * Python 3.8+
    * Библиотека `python-chess`:
        ```bash
        pip install python-chess
        ```
    * Шахматный движок Stockfish (скачать с официального сайта).

2.  **Настройка:**
    * Откройте `config.json`.
    * Укажите путь к вашему движку в поле `"stockfish_path"`.
    * Настройте параметры анализа (`engine_depth`, `engine_threads`, `engine_hash`).

3.  **Запуск:**
    Положите ваши `.pgn` файлы в папку с скриптом и запустите:
    ```bash
    python chess_analyze.py
    ```

4.  **Результат:**
    Рядом с каждым исходным файлом появится файл `*_analyze.pgn` с комментариями, вариантами и классификацией ошибок.
    В файле `chess_log.txt` будет подробный отчет о работе программы.

## Конфигурация (config.json)

* Настройки движка (Stockfish)
    * `stockfish_path`: Полный или относительный путь к исполняемому файлу движка (.exe).
        * Пример: "stockfish-windows-x86-64-avx2.exe" (если лежит рядом) или "C:/Chess/Engine/stockfish-windows-x86-64-avx2.exe".
    * `engine_depth`: Глубина анализа (в полуходах).
        * Чем больше, тем глубже смотрит движок
        * Пример: 20, (ищем на глубине 20 полуходов или 10 ходов)
    * `engine_hash`: Количество ядер процессора, выделяемых движку.
        * Ускоряет анализ. Ставьте количество физических ядер вашего ЦП минус 2.
    * `stockfish_path`: Размер памяти (в МБ) для хеш-таблиц движка.
        * Позволяет движку запоминать позиции и не считать их дважды.

* Настройки поиска ошибок
    * `error_threshold`: Порог ошибки в сантипешках (100 cp = 1 пешка).
        * Если после хода игрока оценка падает на это число (или больше), ход помечается как ошибка.
        * Пример: 200 (ошибка, если проиграл 2 пешки одним ходом).
    * `thresholds`: Классификация ошибок для значков (NAG) в PGN файле.
        * `inaccuracy`: Неточность (?!). Потеря > 100 cp.
        * `mistake`: Ошибка (?). Потеря > 200 cp.
        * `blunder`: Грубый зевок (??). Потеря > 300 cp.
    * `mate_score`: Техническое значение оценки "Мат".
        * Не меняйте это значение (10000), оно нужно для внутренних расчетов.
    * `mate_depth_trigger`: Глубина мата, которую мы считаем "очевидной".
        * Если был мат в 1-5 ходов, и ученик его не увидел — это помечается как грубый зевок.
        * Пример: 5 (ищем пропущенные маты в 5 ходов и короче).

* Фильтры учеников
    * `student_game_count_trigger`: Минимальное количество партий в базе, чтобы считать игрока "Постоянным учеником".
        * Пример: 5 (анализировать только тех, кто сыграл больше 5 партий).
    * `forced_students`: Белый список имен.
        * Игроки из этого списка будут анализироваться всегда, даже если сыграли всего 1 партию.
        * Пример: ["MyLogin", "StudentName"].